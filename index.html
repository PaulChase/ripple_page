<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Ripple Project</title>

		<link rel="stylesheet" href="/dist/app.css" />

		<!-- alpine js -->
		<!-- <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script> -->

		<!-- chart js cdn -->
		<script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>

		<!-- google fonts -->
		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		<link
			href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800&display=swap"
			rel="stylesheet"
		/>

		<style>
			body {
				font-family: "Montserrat", sans-serif;
			}

			tr > td:last-of-type > p {
				color: white;
				font-size: 25px;
				padding: 2px 12px;
				border-radius: 10px;
				background-color: #3366ff;
				display: inline-flex;
				justify-content: center;
				align-items: center;
			}
		</style>
	</head>
	<body class="bg-gray-50">
		<main>
			<!-- hero section -->
			<section
				style="background: url('/img/hero.png') center center/cover no-repeat; min-height: 80vh"
				class="relative flex justify-center items-center px-4 py-8"
			>
				<div class="absolute top-0 left-0 w-full h-full bg-black/60"></div>
				<div class="z-20 text-white relative h-full lg:w-3/5 mx-auto space-y-6 mb-10">
					<h1 class="md:text-5xl text-3xl font-bold text-center text-orange-600">About the Ripple Project</h1>
					<p class="md:text-xl text-base font-medium leading-9">
						The Ripple project is focused on identifying, engaging and building the capacity of young people to serve as
						peer educators on the prevention of Gender Based Violence (GBV) and harmful practices (HP) and in promoting
						Sexual and Reproductive Health and Rights (SRHR) in Nigeria. The Ripple project is currently been
						implemented in the Six Spotlight states, and has been led by the UNFPA/Spotlight implementing partner
						working in such states.
					</p>
				</div>
			</section>

			<div
				class="lg:flex grid grid-cols-2 gap-6 lg:justify-evenly lg:items-center w-11/12 md:w-4/5 mx-auto shadow rounded-md p-6 -m-14 z-30 relative bg-white"
			>
				<div class="space-y-3 text-center">
					<h3 class="text-4xl font-bold text-orange-500">22</h3>
					<p class="font-medium text-gray-600">Total Educated</p>
				</div>
				<div class="space-y-3 text-center">
					<h3 class="text-4xl font-bold text-orange-500">7</h3>
					<p class="font-medium text-gray-600">Personal Hygiene</p>
				</div>
				<div class="space-y-3 text-center">
					<h3 class="text-4xl font-bold text-orange-500">3</h3>
					<p class="font-medium text-gray-600">SGBV</p>
				</div>
				<div class="space-y-3 text-center">
					<h3 class="text-4xl font-bold text-orange-500">12</h3>
					<p class="font-medium text-gray-600">FGM</p>
				</div>
				<div class="space-y-3 text-center">
					<h3 class="text-4xl font-bold text-orange-500">22</h3>
					<p class="font-medium text-gray-600">Pregnancy & Family</p>
				</div>
			</div>

			<section class="p-4 mt-20">
				<div class="max-w-2xl mx-auto">
					<h3 class="text-lg md:text-2xl text-orange-600 font-semibold mb-4 text-center">
						Gender Distribution of Peers Educated
					</h3>
					<canvas id="genderChart" height="240">
						<p>Fetching Gender Data</p>
					</canvas>
				</div>
			</section>

			<section class="p-4 md:py-12 bg-sky-50">
				<div class="max-w-2xl mx-auto">
					<h3 class="text-lg md:text-2xl text-orange-600 font-semibold mb-4 text-center">
						Age Distribution of Peers Reached
					</h3>
					<canvas id="ageChart" height="210">
						<p>Fetching Age Data</p>
					</canvas>
				</div>
			</section>

			<section class="px-4 py-6 md:py-12 bg-white">
				<h3
					class="text-xl uppercase text-center text-green-600 p-4 border-4 border-blue-600 rounded-md w-fit mx-auto -mb-6 bg-white relative z-20 font-bold"
				>
					LEADERBOARD
				</h3>
				<div class="max-w-3xl mx-auto relative rounded-xl pt-12 border-4 border-blue-600 overflow-x-auto">
					<table class="w-full sm:rounded-xl overflow-x-auto">
						<tbody id="leaderboard" class="rounded-xl"></tbody>
					</table>
				</div>
			</section>

			<section class="px-4 py-6 lg:py-12 relative">
				<img src="/img/top_bubbles.svg" alt="" class="absolute hidden md:block top-0 left-0" />

				<img src="/img/bottom_bubbles.svg" alt="" class="absolute hidden md:block bottom-0 right-0" />
				<h3 class="text-xl md:text-3xl text-orange-600 font-semibold mt-4 mb-8 md:mb-20 text-center">
					Additional Data Captured
				</h3>
				<div
					class="overflow-x-auto whitespace-nowrap space-x-4 md:space-x-8 max-w-5xl mx-auto md:flex md:justify-center z-10"
				>
					<div class="inline-block relative whitespace-normal">
						<div class="absolute z-10 bg-black/50 top-0 left-0 w-full h-full rounded-md"></div>
						<img src="/img/data_image1.png" class="h-80 md:h-96" />
						<div class="absolute z-20 bg-white/30 bottom-0 left-0 w-full h-auto rounded-md p-2 text-orange-500">
							<h4 class="font-semibold text-center text-xl md:text-3xl">PWDâ€™s Reached</h4>
							<p class="text-3xl md:text-4xl font-bold text-center mt-3">9</p>
						</div>
					</div>

					<div class="inline-block relative whitespace-normal">
						<div class="absolute z-10 bg-black/50 top-0 left-0 w-full h-full rounded-md"></div>
						<img src="/img/data_image2.png" class="h-80 md:h-96" />
						<div class="absolute z-20 bg-white/30 bottom-0 left-0 w-full h-auto rounded-md p-2 text-orange-500">
							<h4 class="font-semibold text-center text-xl md:text-3xl">GBV Cases Reported</h4>
							<p class="text-3xl font-bold md:text-4xl text-center mt-3">12</p>
						</div>
					</div>

					<div class="inline-block relative whitespace-normal">
						<div class="absolute z-10 bg-black/50 top-0 left-0 w-full h-full rounded-md"></div>
						<img src="/img/data_image3.png" class="h-80 md:h-96" />
						<div class="absolute z-20 bg-white/30 bottom-0 left-0 w-full h-auto rounded-md p-2 text-orange-500">
							<h4 class="font-semibold text-center text-xl md:text-3xl">GBV Cases Referred</h4>
							<p class="text-3xl font-bold md:text-4xl text-center mt-3">10</p>
						</div>
					</div>
				</div>
			</section>
		</main>

		<script>
			/*
			const fakeData = [
				["DP", "Name", "points"],
				["/img/dp.jpg", "James kona", 9],
				["/img/dp.jpg", "Ula Bam", 8],
				["/img/dp.jpg", "Jane Doe", 6],
				["/img/dp.jpg", "Emma adam", 4],
				["/img/dp.jpg", "Kim jon", 4],
			];

			createTable(fakeData);
			*/

			getSheet();
			async function getSheet() {
				try {
					const res = await fetch(
						"https://script.google.com/macros/s/AKfycbweKf07JHTqdowigNMszCNJyHgQL20fc0t-a9fT6SOX_fRAF6tPg5Zd6yKbqq8I59Mv/exec"
					);

					const data = await res.json();

					const [genderLabels, genderValues] = data.genderData;

					const [ageLabels, ageValues] = data.ageData;

					// create gender bar chart
					createChart(genderLabels, genderValues, {
						type: "bar",
						label: null,
						backgroundColor: ["#e600e6", "#3366ff", "#ffcc00"],
						elementID: "genderChart",
						showYaxis: true,
					});

					// create age pie chart
					createChart(ageLabels, ageValues, {
						type: "doughnut",
						label: "Age distribution",
						backgroundColor: ["#5388D8", "#064776", "#E65B0B", "#00B45B", "#FF9F40"],
						elementID: "ageChart",
						showYaxis: false,
					});

					createTable(data.leaderBoardData);

					//	console.log(data);
				} catch (error) {
					console.log(error);
				}
			}

			function createTable(leaderBoardData) {
				const theTable = document.getElementById("leaderboard");
				leaderBoardData.forEach((row, index) => {
					// don't display the 1st row, that is the title rows
					if (index === 0) return;
					const tableRow = document.createElement("tr");
					tableRow.classList = "odd:bg-blue-50 even:bg-zinc-50  my-2";
					const indexColoumn = document.createElement("td");
					rank = index;
					indexColoumn.innerHTML = getBadge(rank);
					tableRow.appendChild(indexColoumn);
					row.forEach((rowData, index) => {
						const tableColoumn = document.createElement("td");
						tableColoumn.classList = ` text-gray-600 p-3 text-center  font-semibold last:font-extrabold`;
						if (index === 0) {
							const imgTag = document.createElement("img");
							imgTag.src = rowData;
							imgTag.classList = " h-12 w-12 mx-auto rounded-full border-4 border-blue-600";
							tableColoumn.appendChild(imgTag);
						} else {
							const paragraphTag = document.createElement("p");
							paragraphTag.textContent = rowData;
							tableColoumn.appendChild(paragraphTag);
						}
						tableRow.appendChild(tableColoumn);
					});
					theTable.appendChild(tableRow);
				});
			}

			function getBadge(rank) {
				switch (rank) {
					case 1:
						return `<img src="/img/badge1.png" class="h-12 w-12 mx-auto">`;
					case 2:
						return `<img src="/img/badge2.png" class="h-12 w-12 mx-auto">`;
					case 3:
						return `<img src="/img/badge3.png" class="h-12 w-12 mx-auto">`;

					default:
						return `<p class='text-center'>${rank}</p>`;
				}
			}

			const getLabeslAndValues = (givenData, options) => {
				let labels = [];
				let values = [];
				givenData.forEach((dataRow) => {
					labels.push(dataRow[0]);
					values.push(dataRow[1]);
				});

				createChart(labels, values, options);
			};

			const createChart = (labels, values, options) => {
				const { type, label, backgroundColor, elementID, showYaxis } = options;

				const ctx = document.getElementById(elementID).getContext("2d");

				const myChart = new Chart(ctx, {
					type,
					data: {
						labels,
						datasets: [
							{
								label: "",
								data: values,
								backgroundColor,
							},
						],
					},
					options: {
						scales: {
							y: {
								beginAtZero: true,
								display: showYaxis,
							},
						},
						plugins: {
							legend: {
								labels: {
									// This more specific font property overrides the global property
									font: {
										size: 18,
									},
								},
							},
						},
					},
				});
			};
		</script>
	</body>
</html>
